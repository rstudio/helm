suite: License Helpers
templates:
  - templates/test-license.yaml
values:
  - _base_values.yaml

# Note: License templates output multiple document types (Secrets and ConfigMaps)
# which makes document-index based assertions unreliable. These tests verify
# basic rendering - for detailed verification, use `helm template` manually.

tests:
  # ========================================
  # License Template Rendering Tests
  # ========================================
  - it: should render license template with key configured
    set:
      testLicense:
        licenseKey: "SECRET-KEY-12345"
        licenseServer: ""
        licenseFile: ""
    asserts:
      - hasDocuments:
          count: 4

  - it: should render license template with file configured
    set:
      testLicense:
        licenseKey: ""
        licenseServer: ""
        licenseFile: |
          LICENSE CONTENT
    asserts:
      - hasDocuments:
          count: 4

  - it: should render license template with all options configured
    set:
      testLicense:
        licenseKey: "KEY"
        licenseServer: "server.example.com"
        licenseFile: |
          LICENSE
    asserts:
      - hasDocuments:
          count: 5

  - it: should include release name in license resources
    set:
      testLicense:
        licenseKey: "TEST-KEY"
        licenseServer: ""
        licenseFile: ""
    release:
      name: my-app
    asserts:
      - hasDocuments:
          count: 4
      - matchRegex:
          path: metadata.name
          pattern: "test-license"
        documentIndex: 0
