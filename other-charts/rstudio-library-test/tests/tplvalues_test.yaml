suite: tplvalues Helpers
templates:
  - templates/test-tplvalues.yaml
values:
  - _base_values.yaml

tests:
  # ========================================
  # String Value Rendering Tests
  # ========================================
  - it: should render string value with template expression
    set:
      testTplvalues:
        staticValue: "static"
        templateValue: "{{ .Release.Name }}-suffix"
    release:
      name: my-release
    asserts:
      - isKind:
          of: ConfigMap
      - equal:
          path: metadata.name
          value: test-tplvalues
      - equal:
          path: data.renderedString
          value: "my-release-suffix"

  - it: should pass through non-template strings unchanged
    set:
      testTplvalues:
        staticValue: "plain-static-value"
        templateValue: "no-template-here"
    asserts:
      - equal:
          path: data.staticString
          value: "plain-static-value"
      - equal:
          path: data.renderedString
          value: "no-template-here"

  # ========================================
  # Release Context Tests
  # ========================================
  - it: should access Release.Name in template
    set:
      testTplvalues:
        staticValue: "x"
        templateValue: "prefix-{{ .Release.Name }}"
    release:
      name: test-release
    asserts:
      - equal:
          path: data.renderedString
          value: "prefix-test-release"

  - it: should access Release.Namespace in template
    set:
      testTplvalues:
        staticValue: "x"
        templateValue: "ns-{{ .Release.Namespace }}"
    release:
      name: test
      namespace: production
    asserts:
      - equal:
          path: data.renderedString
          value: "ns-production"

  # ========================================
  # Object Value Rendering Tests
  # ========================================
  - it: should render object value with template expressions
    set:
      testTplvalues:
        staticValue: "x"
        templateValue: "x"
        objectValue:
          name: "{{ .Release.Name }}"
          namespace: "{{ .Release.Namespace }}"
    release:
      name: obj-release
      namespace: obj-namespace
    asserts:
      - matchRegex:
          path: data.renderedObject
          pattern: "obj-release"
      - matchRegex:
          path: data.renderedObject
          pattern: "obj-namespace"

  # ========================================
  # Edge Cases
  # ========================================
  - it: should handle empty string template value
    set:
      testTplvalues:
        staticValue: "x"
        templateValue: ""
    asserts:
      - equal:
          path: data.renderedString
          value: ""

  - it: should handle multiple template expressions in one value
    set:
      testTplvalues:
        staticValue: "x"
        templateValue: "{{ .Release.Name }}-{{ .Release.Namespace }}-app"
    release:
      name: multi
      namespace: test
    asserts:
      - equal:
          path: data.renderedString
          value: "multi-test-app"
